                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 4.2.0 #13081 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module zvb_dma
                                      6 	.optsdcc -mz80
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _zvb_dma_virt_to_phys
                                     12 	.globl _zvb_dma_start_transfer
                                     13 ;--------------------------------------------------------
                                     14 ; special function registers
                                     15 ;--------------------------------------------------------
                           000080    16 _zvb_config_ver_rev	=	0x0080
                           000081    17 _zvb_config_ver_min	=	0x0081
                           000082    18 _zvb_config_ver_maj	=	0x0082
                           00008E    19 _zvb_config_dev_idx	=	0x008e
                           00008F    20 _zvb_config_phys_addr	=	0x008f
                           000090    21 _zvb_ctrl_vpos_low	=	0x0090
                           000091    22 _zvb_ctrl_vpos_high	=	0x0091
                           000092    23 _zvb_ctrl_hpos_low	=	0x0092
                           000093    24 _zvb_ctrl_hpos_high	=	0x0093
                           000094    25 _zvb_ctrl_l0_scr_y_low	=	0x0094
                           000095    26 _zvb_ctrl_l0_scr_y_high	=	0x0095
                           000096    27 _zvb_ctrl_l0_scr_x_low	=	0x0096
                           000097    28 _zvb_ctrl_l0_scr_x_high	=	0x0097
                           000098    29 _zvb_ctrl_l1_scr_y_low	=	0x0098
                           000099    30 _zvb_ctrl_l1_scr_y_high	=	0x0099
                           00009A    31 _zvb_ctrl_l1_scr_x_low	=	0x009a
                           00009B    32 _zvb_ctrl_l1_scr_x_high	=	0x009b
                           00009C    33 _zvb_ctrl_video_mode	=	0x009c
                           00009D    34 _zvb_ctrl_status	=	0x009d
                           0000A0    35 _zvb_peri_text_print_char	=	0x00a0
                           0000A1    36 _zvb_peri_text_curs_y	=	0x00a1
                           0000A2    37 _zvb_peri_text_curs_x	=	0x00a2
                           0000A3    38 _zvb_peri_text_scroll_y	=	0x00a3
                           0000A4    39 _zvb_peri_text_scroll_x	=	0x00a4
                           0000A5    40 _zvb_peri_text_color	=	0x00a5
                           0000A6    41 _zvb_peri_text_curs_time	=	0x00a6
                           0000A7    42 _zvb_peri_text_curs_char	=	0x00a7
                           0000A8    43 _zvb_peri_text_curs_color	=	0x00a8
                           0000A9    44 _zvb_peri_text_ctrl	=	0x00a9
                           0000A1    45 _zvb_peri_spi_ctrl	=	0x00a1
                           0000A2    46 _zvb_peri_spi_clk_div	=	0x00a2
                           0000A3    47 _zvb_peri_spi_ram_len	=	0x00a3
                           0000A7    48 _zvb_peri_spi_fifo	=	0x00a7
                           0000A8    49 _zvb_peri_spi_array_0	=	0x00a8
                           0000A9    50 _zvb_peri_spi_array_1	=	0x00a9
                           0000AA    51 _zvb_peri_spi_array_2	=	0x00aa
                           0000AB    52 _zvb_peri_spi_array_3	=	0x00ab
                           0000AC    53 _zvb_peri_spi_array_4	=	0x00ac
                           0000AD    54 _zvb_peri_spi_array_5	=	0x00ad
                           0000AE    55 _zvb_peri_spi_array_6	=	0x00ae
                           0000AF    56 _zvb_peri_spi_array_7	=	0x00af
                           0000A0    57 _zvb_peri_crc_ctrl	=	0x00a0
                           0000A1    58 _zvb_peri_crc_data_in	=	0x00a1
                           0000A4    59 _zvb_peri_crc_byte0	=	0x00a4
                           0000A5    60 _zvb_peri_crc_byte1	=	0x00a5
                           0000A6    61 _zvb_peri_crc_byte2	=	0x00a6
                           0000A7    62 _zvb_peri_crc_byte3	=	0x00a7
                           0000A0    63 _zvb_peri_sound_freq_low	=	0x00a0
                           0000A1    64 _zvb_peri_sound_freq_high	=	0x00a1
                           0000A2    65 _zvb_peri_sound_wave	=	0x00a2
                           0000A3    66 _zvb_peri_sound_volume	=	0x00a3
                           0000A0    67 _zvb_peri_sound_sample_fifo	=	0x00a0
                           0000A1    68 _zvb_peri_sound_sample_div	=	0x00a1
                           0000A2    69 _zvb_peri_sound_sample_conf	=	0x00a2
                           0000AB    70 _zvb_peri_sound_left_channel	=	0x00ab
                           0000AC    71 _zvb_peri_sound_right_channel	=	0x00ac
                           0000AD    72 _zvb_peri_sound_hold	=	0x00ad
                           0000AE    73 _zvb_peri_sound_master_vol	=	0x00ae
                           0000AF    74 _zvb_peri_sound_select	=	0x00af
                           0000A0    75 _zvb_peri_dma_ctrl	=	0x00a0
                           0000A1    76 _zvb_peri_dma_addr0	=	0x00a1
                           0000A2    77 _zvb_peri_dma_addr1	=	0x00a2
                           0000A3    78 _zvb_peri_dma_addr2	=	0x00a3
                           0000A9    79 _zvb_peri_dma_clk_div	=	0x00a9
                                     80 ;--------------------------------------------------------
                                     81 ; ram data
                                     82 ;--------------------------------------------------------
                                     83 	.area _DATA
                                     84 ;--------------------------------------------------------
                                     85 ; ram data
                                     86 ;--------------------------------------------------------
                                     87 	.area _INITIALIZED
                                     88 ;--------------------------------------------------------
                                     89 ; absolute external ram data
                                     90 ;--------------------------------------------------------
                                     91 	.area _DABS (ABS)
                                     92 ;--------------------------------------------------------
                                     93 ; global & static initialisations
                                     94 ;--------------------------------------------------------
                                     95 	.area _HOME
                                     96 	.area _GSINIT
                                     97 	.area _GSFINAL
                                     98 	.area _GSINIT
                                     99 ;--------------------------------------------------------
                                    100 ; Home
                                    101 ;--------------------------------------------------------
                                    102 	.area _HOME
                                    103 	.area _HOME
                                    104 ;--------------------------------------------------------
                                    105 ; code
                                    106 ;--------------------------------------------------------
                                    107 	.area _TEXT
                                    108 ;/home/smeagol/dev/Zeal/Zeal-VideoBoard-SDK//include/zvb_hardware.h:59: static inline void zvb_map_peripheral(uint8_t periph)
                                    109 ;	---------------------------------
                                    110 ; Function zvb_map_peripheral
                                    111 ; ---------------------------------
      000000                        112 _zvb_map_peripheral:
      000000 D3 8E            [11]  113 	out	(_zvb_config_dev_idx), a
                                    114 ;/home/smeagol/dev/Zeal/Zeal-VideoBoard-SDK//include/zvb_hardware.h:61: zvb_config_dev_idx = periph;
                                    115 ;/home/smeagol/dev/Zeal/Zeal-VideoBoard-SDK//include/zvb_hardware.h:62: }
      000002 C9               [10]  116 	ret
                                    117 ;src/zvb_dma.c:5: uint32_t zvb_dma_virt_to_phys(void* ptr) __naked {
                                    118 ;	---------------------------------
                                    119 ; Function zvb_dma_virt_to_phys
                                    120 ; ---------------------------------
      000003                        121 _zvb_dma_virt_to_phys::
                                    122 ;src/zvb_dma.c:29: );
      000003 5D               [ 4]  123 	ld	e, l
      000004 7C               [ 4]  124 	ld	a, h
      000005 E6 3F            [ 7]  125 	and	#0x3f
      000007 57               [ 4]  126 	ld	d, a
      000008 7C               [ 4]  127 	ld	a, h
      000009 DB F0            [11]  128 	in	a, (#0xF0)
      00000B 0F               [ 4]  129 	rrca
      00000C 0F               [ 4]  130 	rrca
      00000D 67               [ 4]  131 	ld	h, a
      00000E E6 C0            [ 7]  132 	and	#0xc0
      000010 B2               [ 4]  133 	or	d
      000011 57               [ 4]  134 	ld	d, a
      000012 7C               [ 4]  135 	ld	a, h
      000013 E6 3F            [ 7]  136 	and	#0x3f
      000015 6F               [ 4]  137 	ld	l, a
      000016 26 00            [ 7]  138 	ld	h, #0
      000018 C9               [10]  139 	ret
                                    140 ;src/zvb_dma.c:30: }
                                    141 ;src/zvb_dma.c:31: uint8_t zvb_dma_start_transfer(zvb_dma_descriptor_t *desc) {
                                    142 ;	---------------------------------
                                    143 ; Function zvb_dma_start_transfer
                                    144 ; ---------------------------------
      000019                        145 _zvb_dma_start_transfer::
                                    146 ;src/zvb_dma.c:32: uint32_t desc_phys_addr = zvb_dma_virt_to_phys(desc);
      000019 CDr03r00         [17]  147 	call	_zvb_dma_virt_to_phys
                                    148 ;/home/smeagol/dev/Zeal/Zeal-VideoBoard-SDK//include/zvb_hardware.h:61: zvb_config_dev_idx = periph;
      00001C 3E 04            [ 7]  149 	ld	a, #0x04
      00001E D3 8E            [11]  150 	out	(_zvb_config_dev_idx), a
                                    151 ;src/zvb_dma.c:35: zvb_peri_dma_addr0 = (desc_phys_addr >> 0) & 0xFF;
      000020 7B               [ 4]  152 	ld	a, e
      000021 D3 A1            [11]  153 	out	(_zvb_peri_dma_addr0), a
                                    154 ;src/zvb_dma.c:36: zvb_peri_dma_addr1 = (desc_phys_addr >> 8) & 0xFF;
      000023 7A               [ 4]  155 	ld	a, d
      000024 D3 A2            [11]  156 	out	(_zvb_peri_dma_addr1), a
                                    157 ;src/zvb_dma.c:37: zvb_peri_dma_addr2 = (desc_phys_addr >> 16) & 0xFF;
      000026 7D               [ 4]  158 	ld	a, l
      000027 D3 A3            [11]  159 	out	(_zvb_peri_dma_addr2), a
                                    160 ;src/zvb_dma.c:38: zvb_peri_dma_ctrl = ZVB_PERI_DMA_CTRL_START;
      000029 3E 80            [ 7]  161 	ld	a, #0x80
      00002B D3 A0            [11]  162 	out	(_zvb_peri_dma_ctrl), a
                                    163 ;src/zvb_dma.c:40: return 0; // ERR_SUCCESS
      00002D AF               [ 4]  164 	xor	a, a
                                    165 ;src/zvb_dma.c:41: }
      00002E C9               [10]  166 	ret
                                    167 	.area _TEXT
                                    168 	.area _INITIALIZER
                                    169 	.area _CABS (ABS)
